# AutoStub
http协议的自动化桩
## 桩的应用场景
比方说测试环境没法接入三方服务，如果想要保证服务的可测试性，开发有4种处理方案
① 写一个桩（假想的服务），一个空心服务，只能保证通信过程，固定返回200的处理结果
② 修改被测服务源码，屏蔽掉所有三方服务的交互代码
③ 写死三方服务的处理结果，不进行通信
④ 只提供线上环境来测试
## 这类型桩存在的痛点
① 三方服务异常的处理行为覆盖不到
② 定义的三方处理数据缺少真实性
③ 没法保障被测服务上线以后能和三方服务正常通信，还需要额外的线上调试成本
④ 开发不愿花更多的人力成本时间成本来保障可测试性
⑤ 线上测试的成本过高，或可能影响线上的真实数据
## 什么是自动化桩？
已知接口自动化框架的前提下，如果遇到了依赖服务异常的测试用例，没法落地成自动化脚本。
比方说：
背景-用户登录的场景，底层交互涉及到客户端、account用户服务、yzm验证码校验服务，account是我们的测试对象
用例名“请求登录接口，account处理超时” 操作步骤“step1-请求登录接口，step2-模拟account请求超时的情况，step3-校验登录接口的返回”期望值“返回状态码为500，返回体{"msg":"server error!"}”
自动化桩所提供的能力能将当前用例转换成自动化脚本！！
• 能够接受桩的消息进行校验，相当于验证被测服务请求三方服务协议的正确性！
• 测试用例能直接定义桩的结果返回！
自动化桩可以直接取代掉桩，开发没有额外的开发成本！！！
自动化桩还不需要开发进行部署，全程由测试操盘！！！！
## 实战演练
被测服务背景：多人文档编辑时，有一个痛点，B用户编辑的内容可能会覆盖A用户编辑的内容，所以提出编辑锁的方案，A用户进行文档A编辑后，不允许其他用户编辑同一个文档，B用户请求编辑接口会被拒绝。

展开服务端的测试工作，需要设计依赖服务异常的测试用例。
请求文档编辑接口，fileapp返回403的状态码  期望值：文档编辑接口返回 500状态码，返回体{XXXXXX}
请求文档编辑接口，fileapp返回超时  期望值：文档编辑接口返回 500状态码，返回体{XXXXXX}
请求文档编辑接口，fileapp异常下线  期望值：文档编辑接口返回 503状态码，返回体{XXXXXX}

